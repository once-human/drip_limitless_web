<div class="chat-wrapper chat_group_<?php echo $wo['chat']['group']['group_id'];?>">
	<div class="valign online-toggle-hdr">
		<div class="valign wow_chat_hdr_usr">
			<div class="avatar">
				<img class="cht_hd_avtr" src="<?php echo $wo['chat']['group']['avatar'];?>" alt="<?php echo $wo['chat']['group']['group_name'];?>" />
			</div>
			<div>
				<h3><?php echo $wo['chat']['group']['group_name'];?></h3>
			</div>
		</div>
		<div class="close-chat">
			<div class="dropdown">
				<a href="#" data-toggle="dropdown" data-display="static" role="button" aria-expanded="false">
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M8.12 9.29L12 13.17l3.88-3.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-4.59 4.59c-.39.39-1.02.39-1.41 0L6.7 10.7c-.39-.39-.39-1.02 0-1.41.39-.38 1.03-.39 1.42 0z" /></svg>
				</a>
				<ul class="dropdown-menu dropdown-menu-right tag_create_menu" role="menu">
					<li>
						<a href="javascript:void(0);" onclick="Wo_ManageGChat();">
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" class="hover_path" d="M2 22a8 8 0 1 1 16 0H2zm8-9c-3.315 0-6-2.685-6-6s2.685-6 6-6 6 2.685 6 6-2.685 6-6 6zm7.363 2.233A7.505 7.505 0 0 1 22.983 22H20c0-2.61-1-4.986-2.637-6.767zm-2.023-2.276A7.98 7.98 0 0 0 18 7a7.964 7.964 0 0 0-1.015-3.903A5 5 0 0 1 21 8a4.999 4.999 0 0 1-5.66 4.957z"></path><path fill="currentColor" d="M2 22a8 8 0 1 1 16 0h-2a6 6 0 1 0-12 0H2zm8-9c-3.315 0-6-2.685-6-6s2.685-6 6-6 6 2.685 6 6-2.685 6-6 6zm0-2c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm8.284 3.703A8.002 8.002 0 0 1 23 22h-2a6.001 6.001 0 0 0-3.537-5.473l.82-1.824zm-.688-11.29A5.5 5.5 0 0 1 21 8.5a5.499 5.499 0 0 1-5 5.478v-2.013a3.5 3.5 0 0 0 1.041-6.609l.555-1.943z"></path></svg> <?php echo $wo['lang']['members'];?>
						</a>
					</li>
					<?php if ($wo['chat']['group']['user_id'] == $wo['user']['id']): ?>
						<li>
							<a href="javascript:void(0);" onclick="Wo_EditGChat(event,<?php echo $wo['chat']['group']['group_id'];?>)">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" class="hover_path" d="M9.243 19H21v2H3v-4.243l9.9-9.9 4.242 4.244L9.242 19zm5.07-13.556l2.122-2.122a1 1 0 0 1 1.414 0l2.829 2.829a1 1 0 0 1 0 1.414l-2.122 2.121-4.242-4.242z"></path><path fill="currentColor" d="M5 19h1.414l9.314-9.314-1.414-1.414L5 17.586V19zm16 2H3v-4.243L16.435 3.322a1 1 0 0 1 1.414 0l2.829 2.829a1 1 0 0 1 0 1.414L9.243 19H21v2zM15.728 6.858l1.414 1.414 1.414-1.414-1.414-1.414-1.414 1.414z"></path></svg> <?php echo $wo['lang']['edit_group'];?>
							</a>
						</li>
						<li>
							<a href="javascript:void(0);" onclick="Wo_ClearGroupHistory(<?php echo $wo['chat']['group']['group_id'];?>)">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" class="hover_path" d="M14 19h7v2h-9l-3.998.002-6.487-6.487a1 1 0 0 1 0-1.414L12.12 2.494a1 1 0 0 1 1.415 0l7.778 7.778a1 1 0 0 1 0 1.414L14 19zm1.657-4.485l3.535-3.536-6.364-6.364-3.535 3.536 6.364 6.364z"></path><path fill="currentColor" d="M8.586 8.858l-4.95 4.95 5.194 5.194H10V19h1.172l3.778-3.778-6.364-6.364zM10 7.444l6.364 6.364 2.828-2.829-6.364-6.364L10 7.444zM14 19h7v2h-9l-3.998.002-6.487-6.487a1 1 0 0 1 0-1.414L12.12 2.494a1 1 0 0 1 1.415 0l7.778 7.778a1 1 0 0 1 0 1.414L14 19z"></path></svg> <?php echo $wo['lang']['clear_history'];?>
							</a>
						</li>
						<li>
							<a href="javascript:void(0);" onclick="Wo_DeleteGroupChat(<?php echo $wo['chat']['group']['group_id'];?>)">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" class="hover_path" d="M7 6V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5zm2-2v2h6V4H9z"></path><path fill="currentColor" d="M17 6h5v2h-2v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8H2V6h5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v3zm1 2H6v12h12V8zM9 4v2h6V4H9z"></path></svg> <?php echo $wo['lang']['delete_group'];?>
							</a>
						</li>
					<?php endif ?>
					<?php if ($wo['chat']['group']['user_id'] != $wo['user']['id']): ?>
						<li>
							<a href="javascript:void(0);" onclick="Wo_ExitGroupChat('<?php echo $wo['chat']['group']['group_id'];?>');">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" class="hover_path" d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zM7 11V8l-5 4 5 4v-3h8v-2H7z"></path><path fill="currentColor" d="M5 11h8v2H5v3l-5-4 5-4v3zm-1 7h2.708a8 8 0 1 0 0-12H4A9.985 9.985 0 0 1 12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10a9.985 9.985 0 0 1-8-4z"></path></svg> <?php echo $wo['lang']['exit_group'];?>
							</a>
						</li>
					<?php endif; ?>
				</ul>
			</div>
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" onclick="javascript:$('.group-tab-container-<?php echo $wo['chat']['group']['group_id'];?>').slideToggle(100);"><path fill="currentColor" d="M18 13H6c-.55 0-1-.45-1-1s.45-1 1-1h12c.55 0 1 .45 1 1s-.45 1-1 1z" /></svg>
			<svg class="pointer group_chat_tab_<?php echo $wo['chat']['group']['group_id'];?>" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" onclick="Wo_CloseChat(<?php echo $wo['chat']['group']['group_id'];?>,'group')"><path fill="currentColor" d="M18.3 5.71c-.39-.39-1.02-.39-1.41 0L12 10.59 7.11 5.7c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41L10.59 12 5.7 16.89c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0L12 13.41l4.89 4.89c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L13.41 12l4.89-4.89c.38-.38.38-1.02 0-1.4z" /></svg>
		</div>
	</div>

	<div class="valign chat-tab-container group-tab-container-<?php echo $wo['chat']['group']['group_id'];?> chat-tab-box-<?php echo $wo['chat']['group']['group_id'];?>">
		<div class="valign chat-tab-container-inner">
			<div class="chat-messages-wrapper tag_scroll group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>">
				<div class="chat-messages">
					<?php if (count($wo['chat']['group']['messages']) > 0): ?>
						<?php foreach ($wo['chat']['group']['messages'] as $wo['chatMessage']): ?>
							<?php echo Wo_LoadPage('chat/group-chat-list'); ?>
						<?php endforeach; ?>
					<?php else: ?>
						<div class="empty_state" id="no_messages_<?php echo $wo['chat']['group']['group_id'];?>"><svg xmlns="http://www.w3.org/2000/svg" id="bold" enable-background="new 0 0 32 32" height="512" viewBox="0 0 32 32" width="512"><path d="m26 32h-20c-3.314 0-6-2.686-6-6v-20c0-3.314 2.686-6 6-6h20c3.314 0 6 2.686 6 6v20c0 3.314-2.686 6-6 6z" fill="#f5e6fe"/><path d="m22.333 11.347v2.153c0 1.193-.973 2.167-2.167 2.167h-5.5v1.173c0 1.013.82 1.833 1.833 1.833h.833v1.5c0 .2.12.38.3.46.067.027.133.04.2.04.127 0 .247-.047.34-.133l2.02-1.867h1.973c1.013 0 1.833-.82 1.833-1.833v-3.667c.002-.96-.731-1.74-1.665-1.826z" fill="#d9a4fc"/><circle cx="11.667" cy="17.667" fill="#be63f9" r="2"/><path d="m13.5 20.667h-3.667c-1.011 0-1.833.822-1.833 1.833v1c0 .276.224.5.5.5h6.333c.276 0 .5-.224.5-.5v-1c0-1.011-.822-1.833-1.833-1.833z" fill="#be63f9"/><g fill="#d9a4fc"><path d="m21.333 10v3.5c0 .64-.527 1.167-1.167 1.167h-7c-.639 0-1.166-.527-1.166-1.167v-3.5c0-.06.007-.12.02-.18l4.307 2.547c.207.12.473.12.68 0l4.307-2.547c.013.06.019.12.019.18z"/><path d="m21.313 8.987-4.307 2.547c-.207.12-.473.12-.68 0l-4.306-2.547c.08-.56.567-.987 1.147-.987h7c.58 0 1.066.427 1.146.987z"/></g></svg> <?php echo $wo['lang']['no_messages']; ?></div>
					<?php endif; ?>
				</div>
				<div class="clear"></div>
			</div>
		</div>
		<div class="chat-textarea btn-group">
			<form action="#" id="hren" class="full_width group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>">
				<div class="msg_progress"><div class="indeterminate"></div></div>
				<div class="valign chat-btns-w">
					<span class="btn btn-file chat_optns" id="progressIcon">
						<?php if($wo['config']['fileSharing'] == 1) { ?>
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="21" height="21"><path fill="currentColor" d="M18.08,12.42,11.9,18.61a4.25,4.25,0,0,1-6-6l8-8a2.57,2.57,0,0,1,3.54,0,2.52,2.52,0,0,1,0,3.54l-6.9,6.89A.75.75,0,1,1,9.42,14l5.13-5.12a1,1,0,0,0-1.42-1.42L8,12.6a2.74,2.74,0,0,0,0,3.89,2.82,2.82,0,0,0,3.89,0l6.89-6.9a4.5,4.5,0,0,0-6.36-6.36l-8,8A6.25,6.25,0,0,0,13.31,20l6.19-6.18a1,1,0,1,0-1.42-1.42Z"/></svg>
							<input type="file" id="sendMessasgeFile" name="sendMessageFile" class="pointer" onchange="Wo_SubmitChatGroupForm(event,<?php echo $wo['chat']['group']['group_id'];?>)" />
						<?php } else { ?>
							<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="21" height="21"><path fill="currentColor" d="M19,2H5A3,3,0,0,0,2,5V19a3,3,0,0,0,3,3H19a2.81,2.81,0,0,0,.49-.05l.3-.07.07,0h0l.05,0,.37-.14.13-.07c.1-.06.21-.11.31-.18a3.79,3.79,0,0,0,.38-.32l.07-.09a2.69,2.69,0,0,0,.27-.32l.09-.13a2.31,2.31,0,0,0,.18-.35,1,1,0,0,0,.07-.15c.05-.12.08-.25.12-.38l0-.15A2.6,2.6,0,0,0,22,19V5A3,3,0,0,0,19,2ZM5,20a1,1,0,0,1-1-1V14.69l3.29-3.3h0a1,1,0,0,1,1.42,0L17.31,20Zm15-1a1,1,0,0,1-.07.36,1,1,0,0,1-.08.14.94.94,0,0,1-.09.12l-5.35-5.35.88-.88a1,1,0,0,1,1.42,0h0L20,16.69Zm0-5.14L18.12,12a3.08,3.08,0,0,0-4.24,0l-.88.88L10.12,10a3.08,3.08,0,0,0-4.24,0L4,11.86V5A1,1,0,0,1,5,4H19a1,1,0,0,1,1,1Z"/></svg>
							<input type="file" id="sendMessasgeFile" name="sendMessageFile" onchange="Wo_SubmitChatGroupForm(event,<?php echo $wo['chat']['group']['group_id'];?>);" accept="image/x-png, image/gif, image/jpeg" />
						<?php } ?>
					</span>
					<span class="chat_optns" onclick="Wo_AddEmoToGroup('(<', <?php echo $wo['chat']['group']['group_id'];?>);"><i class="pointer twa-lg twa twa-joy"></i></span>
					<span class="chat_optns" onclick="Wo_AddEmoToGroup('*_*', <?php echo $wo['chat']['group']['group_id'];?>);"><i class="pointer twa-lg twa twa-heart-eyes"></i></span>
					<span class="chat_optns" onclick="Wo_AddEmoToGroup(':o', <?php echo $wo['chat']['group']['group_id'];?>);"><i class="pointer twa-lg twa twa-open-mouth"></i></span>
					<span class="chat_optns" onclick="Wo_AddEmoToGroup(':__(', <?php echo $wo['chat']['group']['group_id'];?>);"><i class="pointer twa-lg twa twa-sob"></i></span>
					<span class="chat_optns" onclick="Wo_AddEmoToGroup(':*', <?php echo $wo['chat']['group']['group_id'];?>);"><i class="pointer twa-lg twa twa-kissing-heart"></i></span>
					<span class="chat_optns" onclick="Wo_AddEmoToGroup(':sleeping:', <?php echo $wo['chat']['group']['group_id'];?>);"><i class="pointer twa-lg twa twa-sleeping"></i></span>
				</div>
				<textarea name="textSendMessage" id="sendMessage" class="form-control" placeholder="<?php echo $wo['lang']['type_message'];?>" onkeydown="Wo_SubmitChatGroupForm(event, <?php echo $wo['chat']['group']['group_id'];?>);" dir="auto" ></textarea>
				<div class="dropup tag_chat_emoji">
					<div class="emo-btn-<?php echo $wo['chat']['group']['group_id'];?> dropdown-toggle" data-toggle="dropdown" data-display="static" role="button" aria-expanded="false">
						<svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24"><path fill="currentColor" d="M12,22c5.514,0,10-4.486,10-10S17.514,2,12,2S2,6.486,2,12S6.486,22,12,22z M15.493,9c0.824,0,1.493,0.669,1.493,1.493 s-0.669,1.493-1.493,1.493S14,11.317,14,10.493S14.669,9,15.493,9z M11.192,15.919c0.529,0.107,1.085,0.107,1.616,0 c0.253-0.052,0.505-0.131,0.75-0.233c0.234-0.1,0.464-0.224,0.679-0.368c0.208-0.142,0.407-0.306,0.591-0.489 c0.183-0.182,0.347-0.381,0.489-0.592l1.658,1.117c-0.215,0.319-0.462,0.619-0.734,0.891c-0.271,0.271-0.57,0.518-0.885,0.73 c-0.322,0.218-0.665,0.403-1.021,0.554c-0.368,0.154-0.746,0.272-1.128,0.35C12.811,17.959,12.404,18,12,18 s-0.811-0.041-1.207-0.122c-0.383-0.077-0.761-0.195-1.127-0.349c-0.357-0.151-0.7-0.337-1.021-0.554 c-0.316-0.214-0.615-0.46-0.888-0.733c-0.271-0.27-0.519-0.569-0.733-0.889l1.658-1.117c0.143,0.211,0.307,0.41,0.488,0.59 c0.185,0.186,0.384,0.35,0.594,0.492c0.213,0.144,0.442,0.268,0.679,0.368C10.687,15.788,10.938,15.867,11.192,15.919z M8.5,9 C9.328,9,10,9.672,10,10.5S9.328,12,8.5,12S7,11.328,7,10.5S7.672,9,8.5,9z"/></svg>
					</div>
					<ul class="emo-container dropdown-menu dropdown-menu-right tag_scroll emo-group-container-<?php echo $wo['chat']['group']['group_id'];?>" role="menu">
						<?php  
							foreach ($wo['emo'] as $code => $name) {
								$code   = $code;
								echo  '<span onclick="Wo_AddEmoToGroup(\'' . $code . '\', ' . $wo['chat']['group']['group_id'] . ');"><i class="pointer twa-lg twa twa-' . $name . '"></i></span>'; 
							} 
						?>
					</ul>
				</div>
			</form>
		</div>
	</div>
</div>

<script type="text/javascript">
  jQuery(document).ready(function($) {
    $('[data-toggle="tooltip"]').tooltip(); 
    var main_hash_id = $('.main_session').val();
    $('.emo-btn-<?php echo $wo['chat']['group']['group_id'];?>').click(function () {
        $('.emo-group-container-<?php echo $wo['chat']['group']['group_id'];?>').toggle();
    });
	
	<?php if ($wo['config']['node_socket_flow'] == "1") { ?>
    $('.group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>').scroll(
      ()=>{
        var st = $('.group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>').scrollTop();  
        if(st==0) {
          socket.emit("loadmore_group", {from_id: _getCookie("user_id"), group_id: '<?php echo $wo['chat']['group']['group_id'];?>', before_message_id: $(".chat-messages").find(".messages-wrapper").attr("id").substr("messageId_".length)}, (data)=>{
            var chat_messages_wrapper = $('.group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>');
            chat_messages_wrapper.find(".chat-messages").prepend(data.html); 
          })
        }
      })
    <?php } ?>

    $(".clear_group_chat_<?php echo $wo['chat']['group']['group_id'];?>").click(function(event) {
      event.stopPropagation();
      $.ajax({
        url: Wo_Ajax_Requests_File(),
        type: 'GET',
        dataType: 'json',
        data: {f: 'chat',s:'clear_group_chat',id:'<?php echo $wo['chat']['group']['group_id'];?>'},
      })
      .done(function(data) {
        if (data.status == 200) {
          $(".group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>").empty();
        }
      })
      .fail(function() {
        console.log("error");
    });
    });
	
	console.log("Group chat "+'<?php echo $wo['chat']['group']['group_id'];?>')
	
	<?php if ($wo['config']['node_socket_flow'] == "1") { ?>
    var chat_messages_wrapper = $('.group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>');
      $('.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').submit(function(e) { 
        e.preventDefault();
        var text_message = escapeHTML($('.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?> #sendMessage').val());
        socket.emit("group_message", {
          group_id: '<?php echo $wo['chat']['group']['group_id'];?>', 
          from_id: _getCookie("user_id"),
          username: '<?php echo $wo['user']['username']; ?>',
          msg: text_message,
          isSticker: false
        },  (data)=>{
          if (data.status == 200) {

            if ($('#no_messages_<?php echo $wo['chat']['group']['group_id'];?>').length > 0) {
              $(".group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>").find('.chat-messages').html(data.html);
            }
            else{
              $(".group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>").find('.chat-messages').append(data.html);
            }
			if (data.invalid_file == 1) {
					$("body").snackbar({
						message: "<?php echo str_replace('{file_size}', Wo_SizeUnits($wo['config']['maxUpload']), $wo['lang']['file_too_big']); ?>"
					});
              }
              if (data.invalid_file == 2) {
					$("body").snackbar({
						message: "<?php echo $wo['lang']['file_not_supported']; ?>"
					});
              }
            if (data.file == true) {
              $('form.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeOut(100);
            }
            
          }
		  else if(data.status == 500 && data.invalid_file == 1){
				$("body").snackbar({
					message: "<?php echo str_replace('{file_size}', Wo_SizeUnits($wo['config']['maxUpload']), $wo['lang']['file_too_big']); ?>"
				});
              $('form.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeOut(100);
            }
            else if(data.status == 500 && data.invalid_file == 2){
				$("body").snackbar({
					message: "<?php echo $wo['lang']['file_not_supported']; ?>"
				});
              $('form.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeOut(100);
            }
            else if(data.status == 500 && data.invalid_file == 3){
				$("body").snackbar({
					message: "<?php echo $wo['lang']['free_plan_upload']; ?>",
					option: true,
					optionText: "<?php echo $wo['lang']['upgrade']; ?>",
					callback: function() {
						window.location.href = "<?php echo Wo_SeoLink('index.php?link1=go-pro'); ?>";
					}
				});
				$('form.chat-sending-form-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeOut(100);
            }
          $(".chat_group_<?php echo $wo['chat']['group']['group_id'];?>").find('#sendMessasgeFile').val('');
          $(".chat_group_<?php echo $wo['chat']['group']['group_id'];?>").find('textarea').val('');
          setTimeout(function() {
                chat_messages_wrapper.scrollTop(chat_messages_wrapper[0].scrollHeight);
          }, 100);
        });
        return false
      });
    <?php } ?>

<?php if ($wo['config']['node_socket_flow'] == "0"){?>
    var chat_messages_wrapper = $('.group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>');
    chat_messages_wrapper.scrollTop(chat_messages_wrapper[0].scrollHeight);
    $('.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').ajaxForm({
        url: Wo_Ajax_Requests_File() + '?f=chat&s=send_message&group_id=<?php echo $wo['chat']['group']['group_id'];?>&hash=' + main_hash_id,
        type:"POST",
        uploadProgress: function() {
		  $('form.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeIn(100);
        },
        success: function(data) {
            if (data.status == 200) {

              if ($('#no_messages_<?php echo $wo['chat']['group']['group_id'];?>').length > 0) {
                $(".group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>").find('.chat-messages').html(data.html);
              }
              else{
                $(".group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>").find('.chat-messages').append(data.html);
              }
              if (data.invalid_file == 1) {
					$("body").snackbar({
						message: "<?php echo str_replace('{file_size}', Wo_SizeUnits($wo['config']['maxUpload']), $wo['lang']['file_too_big']); ?>"
					});
              }
              if (data.invalid_file == 2) {
					$("body").snackbar({
						message: "<?php echo $wo['lang']['file_not_supported']; ?>"
					});
              }
              if (data.file == true) {
                $('form.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeOut(100);
              }
              
            }
            else if(data.status == 500 && data.invalid_file == 1){
				$("body").snackbar({
					message: "<?php echo str_replace('{file_size}', Wo_SizeUnits($wo['config']['maxUpload']), $wo['lang']['file_too_big']); ?>"
				});
              $('form.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeOut(100);
            }
            else if(data.status == 500 && data.invalid_file == 2){
				$("body").snackbar({
					message: "<?php echo $wo['lang']['file_not_supported']; ?>"
				});
              $('form.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeOut(100);
            }
            else if(data.status == 500 && data.invalid_file == 3){
				$("body").snackbar({
					message: "<?php echo $wo['lang']['free_plan_upload']; ?>",
					option: true,
					optionText: "<?php echo $wo['lang']['upgrade']; ?>",
					callback: function() {
						window.location.href = "<?php echo Wo_SeoLink('index.php?link1=go-pro'); ?>";
					}
				});
				$('form.chat-sending-form-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeOut(100);
            }
            $(".chat_group_<?php echo $wo['chat']['group']['group_id'];?>").find('#sendMessasgeFile').val('');
            $(".chat_group_<?php echo $wo['chat']['group']['group_id'];?>").find('textarea').val('');
            setTimeout(function() {
                  chat_messages_wrapper.scrollTop(chat_messages_wrapper[0].scrollHeight);
            }, 100);

        }

    });

    setInterval(function(){
      var last_group_message = ($("[data-group-tmessage-id]").length > 0) ? $("[data-group-tmessage-id]").last().attr('data-group-tmessage-id') : 0;
      $.ajax({
        url: Wo_Ajax_Requests_File(),
        type: 'GET',
        dataType: 'json',
        data: {f: 'chat',s:'get_new_group_messages',message_id:last_group_message,group_id:'<?php echo $wo['chat']['group']['group_id'];?>'},
      })
      .done(function(data) {
        if (data.status == 200) {
          if ($(".group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>").find('.no_message').length > 0) {
            $(".group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>").find('.chat-messages').html(data.html);
          }else{
            $(".group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>").find('.chat-messages').append(data.html);
          }
          
          chat_messages_wrapper.scrollTop(chat_messages_wrapper[0].scrollHeight);
        }
      })
      .fail(function() {
        console.log("error");
      })
    },5000);
	<?php } ?>
  });

  function Wo_SubmitChatGroupForm(e, id) {
	<?php if ($wo['config']['node_socket_flow'] == "1"){ ?>
      if ($("#sendMessasgeFile").val() != '') {
        e.preventDefault();
        var chat_messages_wrapper = $('.group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>');
        chat_messages_wrapper.scrollTop(chat_messages_wrapper[0].scrollHeight);
        var main_hash_id = $('.main_session').val();

        $('.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').ajaxSubmit({
            url: Wo_Ajax_Requests_File() + '?f=chat&s=send_message&group_id=<?php echo $wo['chat']['group']['group_id'];?>&hash=' + main_hash_id,
            type:"POST",
            uploadProgress: function() {
              $('form.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeIn(100);
            },
            success: function(data) {
                if (data.status == 200) {

                  if ($('#no_messages_<?php echo $wo['chat']['group']['group_id'];?>').length > 0) {
                    $(".group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>").find('.chat-messages').html(data.html);
                  }
                  else {
                    $(".group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>").find('.chat-messages').append(data.html);
                  }
                  var dom = $($.parseHTML(data.html));
                  var mediaId = dom.attr("data-group-tmessage-id");
                  
                  console.log("Group media id to be found here")
				  if (data.invalid_file == 1) {
					$("body").snackbar({
						message: "<?php echo str_replace('{file_size}', Wo_SizeUnits($wo['config']['maxUpload']), $wo['lang']['file_too_big']); ?>"
					});
				  }
				  if (data.invalid_file == 2) {
						$("body").snackbar({
							message: "<?php echo $wo['lang']['file_not_supported']; ?>"
						});
				  }
                  else {
                    socket.emit("group_message", {
                      group_id: '<?php echo $wo['chat']['group']['group_id'];?>', 
                      from_id: _getCookie("user_id"),
                      username: '<?php echo $wo['user']['username']; ?>',
                      mediaId: mediaId,
                      isSticker: false
                    })
                  }

                  if (data.file == true) {
                    $('form.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeOut(100);
                  }
                } 
				else if(data.status == 500 && data.invalid_file == 1){
					$("body").snackbar({
						message: "<?php echo str_replace('{file_size}', Wo_SizeUnits($wo['config']['maxUpload']), $wo['lang']['file_too_big']); ?>"
					});
				  $('form.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeOut(100);
				}
				else if(data.status == 500 && data.invalid_file == 2){
					$("body").snackbar({
						message: "<?php echo $wo['lang']['file_not_supported']; ?>"
					});
				  $('form.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeOut(100);
				}
				else if(data.status == 500 && data.invalid_file == 3){
					$("body").snackbar({
						message: "<?php echo $wo['lang']['free_plan_upload']; ?>",
						option: true,
						optionText: "<?php echo $wo['lang']['upgrade']; ?>",
						callback: function() {
							window.location.href = "<?php echo Wo_SeoLink('index.php?link1=go-pro'); ?>";
						}
					});
					$('form.chat-sending-form-<?php echo $wo['chat']['group']['group_id'];?>').find('.msg_progress').fadeOut(100);
				}

                $(".chat_group_<?php echo $wo['chat']['group']['group_id'];?>").find('#sendMessasgeFile').val('');
                $(".chat_group_<?php echo $wo['chat']['group']['group_id'];?>").find('textarea').val('');
                setTimeout(function() {
                      chat_messages_wrapper.scrollTop(chat_messages_wrapper[0].scrollHeight);
                }, 100);
          }
        });
       }
       else if (e.keyCode == 13 && e.shiftKey == 0 || $("#sendMessasgeFile").val() != '') {
          e.preventDefault();
          if(!groupChatListener["<?php echo $wo['chat']['group']['group_id'];?>"]){
          console.log("Listening to group messages")
          groupChatListener["<?php echo $wo['chat']['group']['group_id'];?>"] = 1;
      }
     
      var chat_messages_wrapper = $('.group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>');
      chat_messages_wrapper.scrollTop(chat_messages_wrapper[0].scrollHeight);
       
       $('.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').submit()
          // $('.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').submit();
       }
	<?php } else { ?>
    document.title = document_title;
    chat_tab_container = $('.chat_main_' + id);
    if (e.keyCode == 13 && e.shiftKey == 0 || $("#sendMessasgeFile").val() != '') {
        e.preventDefault();
        $('.group-chat-sending-<?php echo $wo['chat']['group']['group_id'];?>').submit();
    }
	<?php } ?>
  }

 function Wo_ClearGroupHistory(id = false){
    if (!id) { return false;}
    $.ajax({
      url: Wo_Ajax_Requests_File(),
      type: 'GET',
      dataType: 'json',
      data: {f: 'chat',s:'clear_group_chat',group_id:'<?php echo $wo['chat']['group']['group_id'];?>'},
    })
    .done(function(data) {
      if (data.status == 200) {
        $(".group-messages-wrapper-<?php echo $wo['chat']['group']['group_id'];?>")
        .find('.chat-messages')
        .html(
          '\
            <p class="no_message" id="no_messages_<?php echo $wo['chat']['group']['group_id'];?>">\
            <?php echo $wo['lang']['conversation_deleted']; ?>\
            </p>'
          );
      }
    })
    .fail(function() {
      console.log("error");
    })
  }
  function Wo_DeleteGroupChat(id = false){
    if (!id) {return false}
    $.ajax({
      url: Wo_Ajax_Requests_File(),
      type: 'GET',
      dataType: 'json',
      data: {f: 'chat',s:'delete_group_chat',group_id:'<?php echo $wo['chat']['group']['group_id'];?>'},
    })
   .done(function(data) {
      if (data.status == 200) {
        $('.chat_main_0').toggle(100,function(){
          $(this).remove();
          $("#group_tab_<?php echo $wo['chat']['group']['group_id'];?>").slideUp(function(){
            $(this).remove();
          })
        });
      }
    })
    .fail(function() {
      console.log("error");
    })
  }
  function Wo_ExitGroupChat(id = false){
    if (!id) {return false}
    $.ajax({
      url: Wo_Ajax_Requests_File(),
      type: 'GET',
      dataType: 'json',
      data: {f: 'chat',s:'exit_group_chat',group_id:'<?php echo $wo['chat']['group']['group_id'];?>'},
    })
   .done(function(data) {
      if (data.status == 200) {
        $('.chat_main_0').toggle(100,function(){
          $(this).remove();
          $("#group_tab_<?php echo $wo['chat']['group']['group_id'];?>").slideUp(function(){
            $(this).remove();
          })
        });
      }
    })
    .fail(function() {
      console.log("error");
    })
  }

  function Wo_ManageGChat(){
    $.ajax({
      url: Wo_Ajax_Requests_File(),
      type: 'GET',
      dataType: 'json',
      data: {f: 'chat',s:'group_parts',group_id:'<?php echo $wo['chat']['group']['group_id'];?>'},
    })
    .done(function(data) {
      if (data.status == 200) {
        $('#manage_group_chat').find('.modal-body').html(data.parts);
        $('#manage_group_chat').find('#group_chat_mbrs').html(data.count);
        $('#manage_group_chat').modal('show');
      }
    })
    .fail(function() {
      console.log("error");
    })
  }
  function escapeHTML(string) {
    var pre = document.createElement('pre');
    var text = document.createTextNode( string );
    pre.appendChild(text);
    return pre.innerHTML;
}
</script>